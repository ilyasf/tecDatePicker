$(function(){$("input[data-role='tec-date']").bind("tap",b);var e=datePickerLangPack;var a={};var c=function(){var f="tec-dialogue-",g=0;while(a.hasOwnProperty(f+g)){g++}return f+g};var d=function(f){this.inputEl=f;this.dialogueInit=false;this.id=c();this.defDateFormat="d.m.Y";a[this.id]=this;this.getId=function(){return this.id};this.show=function(){if(this.dialogueInit===false){this.createDateDialog()}this.showDialogue();this.setDialogueValue()};this.createDateDialog=function(){var g=$.mobile.activePage.find("div[data-role='content']:visible:visible");g.append(this.getPopupTemplate());this.dateDialog=$(".tec-date-picker-dialogue").popup({corners:false});this.dialogueInit=true;this.initEvents()};this.initEvents=function(){$("div[data-picker-id="+this.getId()+"]").bind("tap",this.listenEvents.bind(this))};this.listenEvents=function(g){var h=$(g.target);switch(h.attr("class")){case"data-picker-cancel-btn":this.closeDialogue();break;case"data-picker-arrow-up":this.upValue(h);break;case"data-picker-arrow-down":this.downValue(h);break;case"data-picker-success-btn":this.saveValue();break;default:break}};this.upValue=function(g){var h=g.parent();switch(h.index()){case 0:this.incrementDate();break;case 1:this.incrementMonth();break;case 2:this.incrementYear();break;default:break}};this.downValue=function(g){var h=g.parent();switch(h.index()){case 0:this.decrementDate();break;case 1:this.decrementMonth();break;case 2:this.decrementYear();break;default:break}};this.maxDateCount=function(g,h){if(g===1){if(h%4==0){if(h%100==0){if(h%400==0){return 29}else{return 28}}else{return 29}}else{return 28}}else{if([0,2,4,6,7,9,11].indexOf(g)!==-1){return 31}else{return 30}}};this.incrementDate=function(){var g=this.getDate(),i=this.getMonth(),h=this.getYear();if(g<this.maxDateCount(i,h)){g++}else{g=1}this.setDate(g)};this.decrementDate=function(){var g=this.getDate(),i=this.getMonth(),h=this.getYear();if(g<=1){g=this.maxDateCount(i,h)}else{g--}this.setDate(g)};this.incrementMonth=function(){var g=this.getDate(),i=this.getMonth(),h=this.getYear();if(i<11){i++}else{i=0}if(g>this.maxDateCount(i,h)){this.setDate(this.maxDateCount(i,h))}this.setMonth(i)};this.decrementMonth=function(){var g=this.getDate(),i=this.getMonth(),h=this.getYear();if(i<=0){i=11}else{i--}if(g>this.maxDateCount(i,h)){this.setDate(this.maxDateCount(i,h))}this.setMonth(i)};this.incrementYear=function(){var g=this.getYear();this.setYear(++g)};this.decrementYear=function(){var g=this.getYear();g--;if(g<0){g=0}this.setYear(g)};this.getDate=function(){return Number($($("div[data-picker-id="+this.getId()+"] .data-picker-value-row td")[0]).text())};this.setDate=function(g){$($("div[data-picker-id="+this.getId()+"] .data-picker-value-row td")[0]).text(g);return this};this.getMonth=function(){var g=$($("div[data-picker-id="+this.getId()+"] .data-picker-value-row td")[1]).text();return e.months.indexOf(g)};this.setMonth=function(g){$($("div[data-picker-id="+this.getId()+"] .data-picker-value-row td")[1]).text(e.months[g]);return this};this.getYear=function(){return Number($($("div[data-picker-id="+this.getId()+"] .data-picker-value-row td")[2]).text())};this.setYear=function(g){$($("div[data-picker-id="+this.getId()+"] .data-picker-value-row td")[2]).text(g)};this.closeDialogue=function(){this.dateDialog.popup("close")};this.saveValue=function(){var g=this.getDate(),i=this.getMonth(),h=this.getYear();this.inputEl.val(this.toFormatDate(g,i,h));this.closeDialogue()};this.setDialogueValue=function(){var h=this.inputEl.val(),g;if(h){g=this.parseDate(h,this.inputEl.attr("date-format")||this.defDateFormat);this.setDate(g.date);this.setMonth(g.month);this.setYear(g.year)}};this.parseDate=function(k,o){var q={},m=o.indexOf("d"),l=o.indexOf("m"),i=o.indexOf("Y"),g=function(t,s){var r="";if(t===-1){return false}else{if(t===0){r="^([^\\"+s[t+1]+"]+)\\"+s[t+1]}else{if(s[t+1]===undefined){r="\\"+s[t-1]+"([^\\"+s[t-1]+"]+)$"}else{r="\\"+s[t-1]+"([^\\"+s[t-1]+"]+)\\"+s[t+1]}}}return r},n=g(m,o),h=g(l,o),p=g(i,o),j=new Date();if(n==false){q.date=j.getDate()}else{q.date=Number(k.match(n)[1])}if(h==false){q.month=j.getMonth()}else{q.month=(Number(k.match(h)[1])-1)}if(p==false){q.year=j.getFullYear()}else{q.year=Number(k.match(p)[1])}return q};this.toFormatDate=function(j,g,k){var i=this.inputEl.attr("date-format")||this.defDateFormat,h;g++;if(g<10){g="0"+g}h=i.replace("d",j);h=h.replace("m",g);h=h.replace("Y",k);return h};this.showDialogue=function(){this.dateDialog.popup("open",{transition:"slideup"})};this.getPopupTemplate=function(){var g=new Date();return'<div data-role="popup" class="tec-date-picker-dialogue ui-popup" data-shadow="false" style="width: '+this.getWidth()+'px;" data-picker-id="'+this.getId()+'"><div class="data-picker-body">'+e.headerText+'</div><div class="data-picker-content"><table data-role="table" class="ui-responsive"><thead><tr><th data-priority="1"></th><th></th><th data-priority="1"></th></tr></thead><tbody><tr><td><div class="data-picker-arrow-up"></div></td><td><div class="data-picker-arrow-up"></div></td><td><div class="data-picker-arrow-up"></div></td></tr><tr class="data-picker-value-row"><td>'+g.getDate()+"</td><td>"+e.months[g.getMonth()]+"</td><td>"+g.getFullYear()+'</td></tr><tr><td><div class="data-picker-arrow-down"></div></td><td><div class="data-picker-arrow-down"></div></td><td><div class="data-picker-arrow-down"></div></td></tr></tbody></table></div><div class="data-picker-footer"><div class="data-picker-cancel-btn">'+e.cancel+'</div><div class="data-picker-success-btn">'+e.ok+"</div></div></div>"};this.getWidth=function(){return $.mobile.activePage.find("div[data-role='content']:visible:visible").width()-10}};function b(f){f.preventDefault();var g=$(this);if(!g.attr("date-dialogue-id")){g.attr("date-dialogue-id",function(){var h=new d(g);return h.getId()})}a[g.attr("date-dialogue-id")].show();return false}});